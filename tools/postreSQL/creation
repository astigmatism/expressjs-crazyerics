-- User: crazyerics
-- DROP USER crazyerics;

CREATE USER crazyerics WITH
  LOGIN
  NOSUPERUSER
  INHERIT
  NOCREATEDB
  NOCREATEROLE
  NOREPLICATION;

----------------------------------

-- Database: crazyerics

-- DROP DATABASE crazyerics;

CREATE DATABASE crazyerics
    WITH 
    OWNER = crazyerics
    ENCODING = 'UTF8'
    LC_COLLATE = 'en_GB.UTF-8'
    LC_CTYPE = 'en_GB.UTF-8'
    TABLESPACE = pg_default
    CONNECTION LIMIT = -1;

----------------------------------

CREATE TABLE "sessions" (
    "sid" varchar NOT NULL COLLATE "default",
	"sess" json NOT NULL,
	"expire" timestamp(6) NOT NULL
)
WITH (OIDS=FALSE);
ALTER TABLE "sessions" ADD CONSTRAINT "session_pkey" PRIMARY KEY ("sid") NOT DEFERRABLE INITIALLY IMMEDIATE;
ALTER TABLE "sessions" OWNER to crazyerics;

----------------------------------

-- Table: public.users

-- DROP TABLE public.users;

CREATE TABLE public.users
(
    user_id integer NOT NULL DEFAULT nextval('users_user_id_seq'::regclass),
    user_name character(80) COLLATE pg_catalog."default",
    email_address character(80) COLLATE pg_catalog."default",
    CONSTRAINT users_pkey PRIMARY KEY (user_id)
)
WITH (
    OIDS = FALSE
)
TABLESPACE pg_default;

ALTER TABLE public.users
    OWNER to postgres;
ALTER TABLE public.users
    ADD COLUMN created date;

----------------------------------


CREATE TABLE public.users_sessions
(
    user_id bigint NOT NULL,
    sid character varying NOT NULL,
    last_activity date,
    PRIMARY KEY (user_id, sid),
    CONSTRAINT fk_user_id FOREIGN KEY (user_id)
        REFERENCES public.users (user_id) MATCH SIMPLE
        ON UPDATE NO ACTION
        ON DELETE CASCADE,
    CONSTRAINT fk_sid FOREIGN KEY (sid)
        REFERENCES public.sessions (sid) MATCH SIMPLE
        ON UPDATE NO ACTION
        ON DELETE CASCADE
)
WITH (
    OIDS = FALSE
);

ALTER TABLE public.users_sessions
    OWNER to postgres;

----------------------------------